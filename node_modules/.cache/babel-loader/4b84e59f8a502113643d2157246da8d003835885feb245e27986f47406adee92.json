{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useKeycloak } from \"@react-keycloak/web\";\nimport axios from \"axios\";\nconst KEYCLOAK_TOKEN_URL = `${process.env.REACT_APP_KEYCLOAK_URL}/realms/${process.env.REACT_APP_KEYCLOAK_REALM}/protocol/openid-connect/token`;\nconst BACKEND_API_URL = \"http://localhost:5000/api/auth\"; // Adjust for production\n\nexport const useAuth = () => {\n  _s();\n  const {\n    keycloak\n  } = useKeycloak();\n\n  //   // ðŸ”¹ **Login with Keycloak Directly**\n  //   const login = async (email, password, rememberMe) => {\n  //     try {\n  //         const response = await axios.post(\n  //             `${process.env.REACT_APP_KEYCLOAK_URL}/realms/${process.env.REACT_APP_KEYCLOAK_REALM}/protocol/openid-connect/token`,\n  //             new URLSearchParams({\n  //                 grant_type: \"password\",\n  //                 client_id: process.env.REACT_APP_KEYCLOAK_CLIENT_ID,\n  //                 client_secret: process.env.REACT_APP_KEYCLOAK_CLIENT_SECRET,\n  //                 username: email,\n  //                 password,\n  //             }),\n  //             { headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" } }\n  //         );\n\n  //         const { access_token, refresh_token } = response.data;\n\n  //         // âœ… Store tokens securely\n  //         if (rememberMe) {\n  //             localStorage.setItem(\"token\", access_token);\n  //             localStorage.setItem(\"refreshToken\", refresh_token);\n  //         } else {\n  //             sessionStorage.setItem(\"token\", access_token);\n  //             sessionStorage.setItem(\"refreshToken\", refresh_token);\n  //         }\n\n  //         return response.data;\n  //     } catch (error) {\n  //         console.error(\"Login failed:\", error.response?.data || error.message);\n  //         throw error;\n  //     }\n  // };\n\n  const login = async (email, password, rememberMe) => {\n    try {\n      const response = await axios.post(`${process.env.REACT_APP_KEYCLOAK_URL}/realms/${process.env.REACT_APP_KEYCLOAK_REALM}/protocol/openid-connect/token`, new URLSearchParams({\n        grant_type: \"password\",\n        client_id: process.env.REACT_APP_KEYCLOAK_CLIENT_ID,\n        client_secret: process.env.REACT_APP_KEYCLOAK_CLIENT_SECRET,\n        // âœ… REQUIRED\n        username: email,\n        password\n      }), {\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded\"\n        }\n      });\n      const {\n        access_token,\n        refresh_token\n      } = response.data;\n\n      // âœ… Store tokens securely\n      if (rememberMe) {\n        localStorage.setItem(\"token\", access_token);\n        localStorage.setItem(\"refreshToken\", refresh_token);\n      } else {\n        sessionStorage.setItem(\"token\", access_token);\n        sessionStorage.setItem(\"refreshToken\", refresh_token);\n      }\n      return response.data;\n    } catch (error) {\n      var _error$response;\n      console.error(\"ðŸ”´ Login failed:\", ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || error.message);\n      throw error;\n    }\n  };\n\n  // ðŸ”¹ **Signup (Calls Your Backend, Not Keycloak Directly)**\n  const signup = async (email, password) => {\n    try {\n      const response = await axios.post(\"http://localhost:5000/api/auth/signup\", {\n        email,\n        password\n      });\n      console.log(\"âœ… Signup successful:\", response.data);\n      return response.data;\n    } catch (error) {\n      var _error$response2;\n      console.error(\"ðŸ”´ Signup failed:\", ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data) || error.message);\n      throw error;\n    }\n  };\n\n  // ðŸ”¹ **Forgot Password (Calls Your Backend)**\n  const forgotPassword = async email => {\n    try {\n      await axios.post(`${BACKEND_API_URL}/forgot-password`, {\n        email\n      });\n      return \"Password reset email sent!\";\n    } catch (error) {\n      console.error(\"Forgot password failed:\", error);\n      throw error;\n    }\n  };\n\n  // ðŸ”¹ **Logout from Keycloak**\n  const logout = () => {\n    localStorage.removeItem(\"token\");\n    sessionStorage.removeItem(\"token\");\n    keycloak.logout({\n      redirectUri: window.location.origin\n    });\n  };\n  return {\n    login,\n    signup,\n    forgotPassword,\n    logout,\n    keycloak\n  };\n};\n_s(useAuth, \"RhI8ij3JxyCvHhezn5pOW/NVOzw=\", false, function () {\n  return [useKeycloak];\n});","map":{"version":3,"names":["useKeycloak","axios","KEYCLOAK_TOKEN_URL","process","env","REACT_APP_KEYCLOAK_URL","REACT_APP_KEYCLOAK_REALM","BACKEND_API_URL","useAuth","_s","keycloak","login","email","password","rememberMe","response","post","URLSearchParams","grant_type","client_id","REACT_APP_KEYCLOAK_CLIENT_ID","client_secret","REACT_APP_KEYCLOAK_CLIENT_SECRET","username","headers","access_token","refresh_token","data","localStorage","setItem","sessionStorage","error","_error$response","console","message","signup","log","_error$response2","forgotPassword","logout","removeItem","redirectUri","window","location","origin"],"sources":["C:/Users/madko/Downloads/Keycloack_login/payco-auth/src/auth.js"],"sourcesContent":["import { useKeycloak } from \"@react-keycloak/web\";\r\nimport axios from \"axios\";\r\n\r\nconst KEYCLOAK_TOKEN_URL = `${process.env.REACT_APP_KEYCLOAK_URL}/realms/${process.env.REACT_APP_KEYCLOAK_REALM}/protocol/openid-connect/token`;\r\nconst BACKEND_API_URL = \"http://localhost:5000/api/auth\"; // Adjust for production\r\n\r\nexport const useAuth = () => {\r\n  const { keycloak } = useKeycloak();\r\n\r\n//   // ðŸ”¹ **Login with Keycloak Directly**\r\n//   const login = async (email, password, rememberMe) => {\r\n//     try {\r\n//         const response = await axios.post(\r\n//             `${process.env.REACT_APP_KEYCLOAK_URL}/realms/${process.env.REACT_APP_KEYCLOAK_REALM}/protocol/openid-connect/token`,\r\n//             new URLSearchParams({\r\n//                 grant_type: \"password\",\r\n//                 client_id: process.env.REACT_APP_KEYCLOAK_CLIENT_ID,\r\n//                 client_secret: process.env.REACT_APP_KEYCLOAK_CLIENT_SECRET,\r\n//                 username: email,\r\n//                 password,\r\n//             }),\r\n//             { headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" } }\r\n//         );\r\n\r\n//         const { access_token, refresh_token } = response.data;\r\n\r\n//         // âœ… Store tokens securely\r\n//         if (rememberMe) {\r\n//             localStorage.setItem(\"token\", access_token);\r\n//             localStorage.setItem(\"refreshToken\", refresh_token);\r\n//         } else {\r\n//             sessionStorage.setItem(\"token\", access_token);\r\n//             sessionStorage.setItem(\"refreshToken\", refresh_token);\r\n//         }\r\n\r\n//         return response.data;\r\n//     } catch (error) {\r\n//         console.error(\"Login failed:\", error.response?.data || error.message);\r\n//         throw error;\r\n//     }\r\n// };\r\n\r\n\r\nconst login = async (email, password, rememberMe) => {\r\n  try {\r\n      const response = await axios.post(\r\n          `${process.env.REACT_APP_KEYCLOAK_URL}/realms/${process.env.REACT_APP_KEYCLOAK_REALM}/protocol/openid-connect/token`,\r\n          new URLSearchParams({\r\n              grant_type: \"password\",\r\n              client_id: process.env.REACT_APP_KEYCLOAK_CLIENT_ID,\r\n              client_secret: process.env.REACT_APP_KEYCLOAK_CLIENT_SECRET,  // âœ… REQUIRED\r\n              username: email,\r\n              password,\r\n          }),\r\n          { headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" } }\r\n      );\r\n\r\n      const { access_token, refresh_token } = response.data;\r\n\r\n      // âœ… Store tokens securely\r\n      if (rememberMe) {\r\n          localStorage.setItem(\"token\", access_token);\r\n          localStorage.setItem(\"refreshToken\", refresh_token);\r\n      } else {\r\n          sessionStorage.setItem(\"token\", access_token);\r\n          sessionStorage.setItem(\"refreshToken\", refresh_token);\r\n      }\r\n\r\n      return response.data;\r\n  } catch (error) {\r\n      console.error(\"ðŸ”´ Login failed:\", error.response?.data || error.message);\r\n      throw error;\r\n  }\r\n};\r\n\r\n\r\n  // ðŸ”¹ **Signup (Calls Your Backend, Not Keycloak Directly)**\r\n  const signup = async (email, password) => {\r\n    try {\r\n        const response = await axios.post(\"http://localhost:5000/api/auth/signup\", {\r\n            email,\r\n            password,\r\n        });\r\n\r\n        console.log(\"âœ… Signup successful:\", response.data);\r\n        return response.data;\r\n    } catch (error) {\r\n        console.error(\"ðŸ”´ Signup failed:\", error.response?.data || error.message);\r\n        throw error;\r\n    }\r\n};\r\n\r\n\r\n  // ðŸ”¹ **Forgot Password (Calls Your Backend)**\r\n  const forgotPassword = async (email) => {\r\n    try {\r\n      await axios.post(`${BACKEND_API_URL}/forgot-password`, { email });\r\n      return \"Password reset email sent!\";\r\n    } catch (error) {\r\n      console.error(\"Forgot password failed:\", error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  // ðŸ”¹ **Logout from Keycloak**\r\n  const logout = () => {\r\n    localStorage.removeItem(\"token\");\r\n    sessionStorage.removeItem(\"token\");\r\n    keycloak.logout({ redirectUri: window.location.origin });\r\n  };\r\n\r\n  return { login, signup, forgotPassword, logout, keycloak };\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}